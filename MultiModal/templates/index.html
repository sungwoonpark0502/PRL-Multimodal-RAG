<!DOCTYPE html>
<html>
<head>
    <title>Multimodal RAG Demo</title>
    <style>
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-section, .query-section { margin-bottom: 30px; }
        input[type="file"] { margin: 10px 0; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; cursor: pointer; }
        #response { margin-top: 20px; padding: 15px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Multimodal RAG Demo</h1>
        
        <div class="upload-section">
            <h2>Upload PDF</h2>
            <input type="file" id="pdfUpload" accept=".pdf">
            <button onclick="uploadPDF()">Upload PDF</button>
            <div id="uploadStatus"></div>
        </div>

        <div class="query-section">
            <h2>Test Result</h2>
            <textarea id="testOutput" readonly></textarea>

            <h2>Ask a Question</h2>
            <textarea id="questionInput" placeholder="Enter your question..."></textarea>
            <button onclick="askQuestion()">Ask Question</button>
            <div id="response"></div>
        </div>
    </div>

    <script>
        function uploadPDF() {
            const file = document.getElementById('pdfUpload').files[0];
            const output = document.getElementById('testOutput');

            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('uploadStatus').textContent = 
                    data.message || data.error;

                if (data.texts || data.tables) {
                    output.value = `Texts:\n${data.texts.join('\n')}\n\nTables:\n${JSON.stringify(data.tables, null, 2)}`;

                }
            })
            .catch(error => console.error('Error:', error));
        }

        function askQuestion() {
            const question = document.getElementById('questionInput').value;
            if (!question) return;

            fetch('/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question })
            })
            .then(response => response.json())
            .then(data => {
                const responseDiv = document.getElementById('response');
                responseDiv.innerHTML = data.answer ? 
                    `<strong>Answer:</strong> ${data.answer}` : 
                    `<strong>Error:</strong> ${data.error}`;
            })
            .catch(error => console.error('Error:', error));
        }

    </script>
</body>
</html>