<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multimodal RAG</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script defer src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>

    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="logo">Multimodal RAG</div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <h1>RAG</h1>
        <p>Teach and ask</p>
    </section>

    <!-- Upload & Input Section -->
    <section class="upload-section">
        <div class="card">
            <h2>Upload a File</h2>
            <form action="/" method="post" enctype="multipart/form-data">
                <input type="file" name="file" id="file-upload">
                <label for="file-upload" class="custom-upload-btn">Choose File</label>
                <button type="submit" class="btn">Upload</button>
            </form>
        </div>

        <div class="card">
            <h2>Enter Text</h2>
            <form action="/" method="post">
                <textarea name="text_input" placeholder="Type your text here..."></textarea>
                <button type="submit" class="btn">Submit</button>
            </form>
        </div>
    </section>

    <!-- Display Messages -->
    {% if message %}
        <p class="status-message">{{ message }}</p>
    {% endif %}

    <!-- Query Section -->
    <section class="query-section">
        <h2>Ask a Question</h2>
        <div class="query-box">
            <input type="text" id="query" placeholder="Ask anything...">
        </div>

        <!-- Toggle between DB only and DB + Gemini -->
        <div class="toggle-options">
            <label>
                <input type="radio" name="response_mode" value="db_only" checked>
                DB Only
            </label>
            <label>
                <input type="radio" name="response_mode" value="db_gemini">
                DB + Gemini
            </label>
        </div>

        <button onclick="askQuestion()" class="btn">Ask</button>
        
        <div id="response-container">
            <p id="response"></p>
        </div>
    </section>

    <script>
        function askQuestion() {
            let queryText = document.getElementById("query").value;
            let responseElement = document.getElementById("response");
            
            if (!queryText.trim()) {
                responseElement.innerText = "Please enter a question.";
                return;
            }

            // Get selected response mode (DB only or DB + Gemini)
            let responseMode = document.querySelector('input[name="response_mode"]:checked').value;

            // Display loading message
            responseElement.innerText = "Fetching response...";

            fetch("/query", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query: queryText, response_mode: responseMode })
            })
            .then(response => response.json())
            .then(data => {
                if (data.response) {
                    responseElement.innerText = data.response;
                } else if (data.error) {
                    responseElement.innerText = "Error: " + data.error;
                } else {
                    responseElement.innerText = "Unexpected response format.";
                }
            })
            .catch(error => {
                console.error("Error:", error);
                responseElement.innerText = "Failed to fetch response. Please try again.";
            });
        }
    </script>

</body>
</html>
